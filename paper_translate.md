# A Real-Time and Predictive Trajectory-Generation Motion Planner for Autonomous Ground Vehicles
本文提出了一种适用于自主地面车辆的实时预测运动规划方法。基于改进的状态空间轨迹生成方法，运动规划器可以生成运动学可行的仿人驾驶轨迹。同时，运动规划也通过基于控制空间的卡尔曼预测来考虑其他参与者车辆的未来行为。实验结果表明，与综合局部轨迹规划（ILTP）相比，该运动规划在生成更安全、更平滑的轨迹方面有一定的改进。我们的运动规划器能够处理复杂的交通环境，特别是与其他参与者车辆的交互。
近几十年来，自动地面车辆（AGV）的发展引起了人们的极大关注。运动规划是自动驾驶车辆的核心技术。运动规划员负责生成安全可行的轨迹，同时考虑与其他车辆的相互作用和障碍物的避免。一般来说，开发一个可靠、鲁棒的道路运动规划器面临以下挑战：1）如何在有限的车载计算资源下实时生成运动学可行的轨迹；2）如何通过预测其他车辆的运动来处理周围环境中的实时动态变化。
近年来，大量的新技术被提出发展运动规划。目前的主流技术大致可以分为两种方法：基于图搜索的方法和基于轨迹生成的方法。基于图搜索的方法（例如在[1]–[2][3]中）适用于仅在低速复杂未知环境中导航的AGV。此外，大多数基于图搜索的方法在不考虑速度规划的情况下，生成由短期预计算路径原语组成的路径。因此，它们将更容易引起停止和重定向运动。提出了一种基于轨迹生成的运动规划中考虑车辆运动动力学的方法。也就是说，速度、加速度和力边界与其他约束条件一起考虑，例如避开障碍物。

基于轨迹生成的方法可分为控制空间轨迹生成和状态空间轨迹生成两类。控制空间（如[5]，[6]中）产生的轨迹可以满足车辆运动约束，但它们可能不满足环境约束，如道路几何。相反，状态空间生成的轨迹可以很容易地保证环境约束的满足，尽管生成过程比控制空间轨迹生成方法需要更多的计算资源。因此，状态空间轨迹生成方法在许多实际的AGV中得到了更广泛的应用（例如，在[7]，[8]中）。我们之前在[9]，[10]中的工作为AGV设计了一个集成的局部轨迹规划和跟踪控制（ILTPTC）框架，可以弥合运动规划和低级控制之间的差距。它由基于状态空间轨迹生成方法的运动规划器和轨迹跟踪控制器组成。


以往的大部分工作都将其他交通参与者视为每个规划周期中的静态障碍物，然后选择最佳轨迹以避免与所有障碍物（包括交通参与者和实际静态障碍物）发生碰撞。例如，如图1所示。（1）AGV的感知系统检测到与其他交通参与者的距离。显然，运动规划师选择更安全的轨迹，如蓝色虚线所示，因为A车比AGV远。然而，在几个连续的计划周期之后（如图1所示）。（2）），因为A车的速度比B车慢，AGV将返回前一条车道。因此，即使AVG可以自主驾驶，AGV的运动也不会表现为由人驱动[11]。

因此，动态车辆在运动规划中的行为预测是必不可少的。本文提出了一种考虑其他参与车辆运动的实时运动规划方法。由于该方法容易满足道路几何约束条件，因此基于状态空间轨迹生成方法的自动导向车辆运动规划。然后，设计了一种基于控制空间的卡尔曼预测方法，可以预测其他参与车辆的行为。基于控制空间而不是状态空间的预测器[12]，因为它是有效的，并且需要较少的计算资源。

本文的主要贡献包括两个方面。首先，所提出的运动规划器可以产生运动学上可行的人类驾驶轨迹。规划的轨道比ILTPTC的轨道更安全、更平滑[9]。其次，所提出的运动规划可以实时预测其他参与车辆在复杂情况下的运动。
论文的其余部分组织如下。在第二节中，描述了系统框架以及我们的预测运动规划器和ILTPTC之间的关系。在第三节中，我们讨论了更具体的实时预测运动规划方法。第四节介绍了模拟实验和结果。最后，第五节得出结论，并建议今后的工作。
我们的AGV软件系统的框架如图2所示。ILTPTC（综合局部轨迹规划和跟踪控制）[9]我们之前提出的是一个综合框架，其中包含运动规划器、ILTP（综合局部轨迹规划）和轨迹跟踪控制器。本文提出了一种新的预测运动规划器KPMP（基于卡尔曼预测的运动规划器）来代替ILTPTC框架中的ILTP。具体来说，KPMP共有四个部分：1）路径规划器；2）速度规划器；3）参与者车辆预测器；4）优化性能评估器。KPMP升级了ILTP，提高了运动规划在生成更安全、更平滑的轨迹方面的性能。<br>
![System framework](https://github.com/AegonWei/selfdriving_car_paper/blob/master/images/A%20Real-Time%20and%20Predictive%20Trajectory-Generation%20Motion%20Planner%20for%20Autonomous%20Ground%20Vehicles/planning1.gif)
##### 方法
本节介绍我们的KPMP的详细信息。根据规划周期的顺序，我们的KPMP可分为四部分：1）路径规划；2）速度规划；3）参与车辆预测；4）碰撞试验和性能评估。
###### A.路径规划
路径规划生成可行路径，低级控制器可以轻松遵循这些路径并遵守环境约束。 因此，我们开发了基于状态空间轨迹生成方法的路径规划算法。
首先，我们应用自适应采样算法[4]，根据道路几何形状自适应地采样终端状态（即位置坐标，标题，曲率）。 然后，基于模型预测生成方法[13]生成从初始状态设置的运动学可行路径。 我们利用车辆运动学模型作为预测运动模型。 约束可写为Xf = f（Xi，u），其中Xi是初始状态，Xf是终端状态。 函数f（）是车辆运动学模型，可以用以下公式表示：
<img src="http://latex.codecogs.com/gif.latex?\dot{x}=v*\cos\theta" /> <br>
![](http://latex.codecogs.com/gif.latex?\\dot{y}=v*\\sin\\theta) <br>
![](http://latex.codecogs.com/gif.latex?\\dot{\\theta}=\\kappa*v ) <br>
![](http://latex.codecogs.com/gif.latex?\\dot{\\kappa}=u ) <br>
其中（x，y）是位置坐标，θ是前进，κ是曲率，v是车速，u是转向控制。<br>
众所周知，连续曲率可以保证路径的平滑性，避免不稳定的转向动作。 因此，曲率表示为弧长的多项式函数，以确保每个路径曲率的连续性。 为了获得唯一的解决方案，κ（s）中的未知参数的数量必须等于有用的已知条件的数量。 注意，初始曲率κ（0）确定零阶参数α=κ（0）。 剩下的其他有用条件是终端状态和初始位置。 因此，采用变量s的三次多项式函数。 未知参数涉及q = [b，c，d，sf]。<br>
由于获得这种强非线性微分方程的解析解是非常重要的，因此我们使用New-ton的方法在数值上求解方程。 具体地，通过找到误差的最小值（ΔXf（q））来迭代地计算未知参数。

作为非线性优化问题，对未知参数q0的初始猜测可以极大地影响迭代的收敛。 因此，受[14]的工作启发，我们提出了一个预先计算的查找表，用于存储未知参数的初始猜测。 如图3所示，我们采样几个最终状态，然后根据车身中心坐标框架生成相应的路径。 这些生成的路径的参数被存储为初始猜测。<br>
##### B.速度规划
本小节讨论速度规划算法。首先，我们计算了所需速度的最大速度限制。然后，通过呈现的函数获得期望的速度。最后，设计了可由速度控制器（即节流阀/制动器）执行的速度曲线。请注意，需要设计速度曲线，因为我们的AGV具有运动规划器和控制器的集成框架。

为确保安全，我们设定了最大速度限制（Vmax），该限制由以下三个方面决定：
Vmax = inf {Vmal，Vmlat，Vmlon}（2）
其中最大允许速度（Vmal）由高级行为推理模块估算。最大横向速度（Vmlat）被约束以防止车辆的侧滑并且与道路的曲率和最大横向加速度相关：V^2_{mlat} |κ|≤Accmlat。最大纵向速度（Vmlon）受以下等式限制：（V^2_{mlon}）/（2Decmlon）+Dsafe≤sf，其中Decmlon是最大纵向减速度; Dsafe是安全制动距离;和sf是候选路径的长度。

然后，我们设计生成路径长度的单变量函数（3）来计算Vdesire∈[0，Vmax]。
![](http://latex.codecogs.com/gif.latex?V_{desire} = \\begin{cases}\\frac{2V_{max}}{1+exp(D_{safe}-s)} -V_{max},&\\mathrm{if}\\ s \\geq D_{safe}\\\ 0, & \\mathrm{if}\\ s < D_{safe})

