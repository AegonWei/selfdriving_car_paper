# Trajectory Planning for Autonomous Ground Vehicles Driving in Structured Environments

为了解决结构化环境中自主地面车辆（AGV）的轨迹规划问题，提出了一种基于道路模型的运动学可行的轨迹规划方法。为了应对道路上的避障，
我们开发了一种有效的路径生成方法，使用分段螺旋曲线生成一组满足起点和终点边界约束的连续曲率路径。基于所提出的优化函数，选择最佳路径。
与基于模型的预测轨迹规划器相比，本文提出的方法可以有效地避免收敛慢或无法解决的问题。实验结果表明：该方法不仅保留了基于模型的预测轨迹规划的大部分优点，
而且降低了计算复杂度，满足了实时性要求。所产生的路径的曲率是连续的并且适合于车辆的实际控制。仿真结果表明，该方法能够平滑地跟踪参考路径，
成功避免静态障碍。<br>
##### 介绍
自主驾驶技术被认为在提高驾驶安全性和舒适性方面具有巨大潜力。在过去的十年中，无人驾驶汽车取得了令人瞩目的成就。
但到目前为止，复杂环境的自动驾驶技术尚未成熟。作为自动驾驶技术的关键部分，路径规划中需要解决许多问题[1] [2]。
路径规划器必须能够在各种复杂场景中实时快速有效地生成可执行路径。在结构化环境中，参考路径的几何信息对车辆的本地路径具有强约束，
因此路径规划器在生成本地路径时需要考虑参考路径​​的几何约束。根据感知信息获得参考路径的方法，例如车道和路缘，不能保证曲率和航向角的连续性和平滑性，
这不适合于车辆驾驶。因此，有必要使用本地路径规划器生成运动可行路径。在本文中，我们专注于解决结构化环境中AGV路径规划问题。
在状态空间采样的基础上，我们考虑车辆位置和航向的约束，以实时生成一组运动学可行的路径。<br>
##### 相关工作
地方规划，也称为运动规划，是规划模块的重要组成部分。本地规划在动态交通参与者的情况下实时生成可行路径。在本地规划者中使用的常用方法可以分为两种类型。一种是考虑边界约束的优化方法[3]，[4]，另一种是基于采样的路径生成方法[5]。基于采样的路径生成方法可以分为两类：状态空间采样，控制空间采样[6]。

冯等人。提出了一种基于弧触角的局部路径生成算法，该算法在离散控制空间后生成一系列不同半径的候选弧[7]。 Himmelsbach等。使用Clothoid作为轨迹基元改进了这种方法，同时考虑了当前曲率和AGV的速度[8]。由于控制空间采样具有计算简单，实时性好的特点，因此广泛应用于AGV的局部规划[7]。但是，这种方法也有固有的缺点。例如，生成的轨迹形状太简单，无法处理复杂的障碍物约束。另外，由于该方法没有考虑轨迹的最终状态约束，因此在非可执行轨迹的生成和评估上消耗了大量计算资源。

为了解决控制空间采样中存在的问题，一些学者提出了状态空间采样的方法。状态空间采样方法首先离散状态空间，并且将局部路径生成问题公式化为两点边值问题（BVP）。凯利等人。将车型机器人的转向控制指令表示为关于弧长的多项式，并使用基于梯度的拍摄方法[9] [10]求解未知参数。通过该方法得到的路径曲率是弧长的多项式，便于车辆跟踪。由卡内基梅隆大学使用这种本地规划方法开发的AGV平台赢得了DARPA城市挑战赛的冠军[11]。然而，由于车辆模型的非线性，用于有时不能收敛或收敛的拍摄方法太慢。为了解决这个问题，Ferguson等人。应用初始参数查找表来提高算法的收敛速度[12]。 Kanayama等。使用分段螺旋曲线连接平面上的两个点，同时确保生成的路径曲率是连续的[13]。但是这种方法只考虑曲率约束而不考虑障碍物的存在。为了实时处理障碍，我们开发了一种基于采样的分段螺旋曲线路径生成方法，以在满足参考路径约束的同时生成一系列运动学可行路径。

本文的其余部分组织如下。第3节主要描述了利用分段螺旋曲线生成局部路径的方法，并将实验结果与基于模型的预测路径规划器的路径生成方法进行了比较。第4节显示了模拟结果。第5节讨论了结论和未来的工作。<br>
#### 第三节
##### 基于抽样的分段螺旋曲线路径生成方法
由于状态空间采样具有充分利用参考路径的几何约束和生成路径的空间分布的良好一致性的优点，因此吸引了许多学者研究它。 状态空间采样的总体思想是首先对轨迹的末端进行采样，然后将轨迹生成问题转换为两点边值问题[14]。 在这一部分中，我们提出了一种基于采样的分段螺旋曲线路径生成方法。 生成方法主要包括三个步骤。 首先，沿参考路径采样。 第二，生成候选路径。 最后，根据优化函数选择最佳路径。<br>
###### A.沿参考路径采样最终状态
在实际环境中，参考路径周围通常存在各种障碍，因此本地运动规划器需要实时生成一组候选路径以确保其灵活性和可行性。传统的纯追踪算法在考虑预测点的位置约束的同时具有良好的实时性。然而，该方法忽略预览点的航向角约束，使得生成的候选路径不能与预览点处的参考路径的标题一致。当车辆的速度高或参考路径的曲率太大时，可能引起诸如车辆突然转向或过冲的问题。为了确保生成的候选路径和参考路径是共形的，我们将航向约束添加到最终采样状态。给定车辆初始状态[xI，yI，θI]。我们采样一组最终状态[xT，yT，θT]，如图1所示。为了确保候选路径和参考路径对齐，最终采样状态的航向等于参考路径最近航向点。<br>
![State space sampling](https://github.com/AegonWei/selfdriving_car_paper/blob/master/images/Trajectory%20Planning%20for%20Autonomous%20Ground%20Vehicles%20Driving%20in%20Structured%20Environments/State%20space%20sampling.gif)
B.分段螺旋曲线路径生成方法
在本文中，生成的路径的航向角是路径长度的分段立方函数。 如图2所示，对于两点：PI（xI，yI，θI），PT（xT，yT，θT），如果α1=α2，我们将这两个点定义为对称配置。 根据螺旋曲线的性质，两点是对称配置，我们可以用螺旋连接两点：
![equation1](https://github.com/AegonWei/selfdriving_car_paper/blob/master/images/Trajectory%20Planning%20for%20Autonomous%20Ground%20Vehicles%20Driving%20in%20Structured%20Environments/%E9%80%89%E5%8C%BA_001.bmp)
其中l是曲线的长度，κ（s）是曲率，d是两点之间的直线距离，α=θT-θI。

如果给定的两点PI和PT不是对称配置，我们不能使用螺旋直接连接两个点。 我们需要找到一个中间点O.它分别使PIO和PT Oare对称配置。

当θI=θT时，中间点集合为：
\begin{equation*}
U1=\{(x,y)\vert (x-x_{I})(y-y_{I})=(x-x_{T})(y-y_{T})\}
\tag{2}
\end{equation*}
当θI≠θT时，中间点集合为：
\begin{align*}
U2=\{(x,y)\vert (x-x_{I})(x-x_{T})+(y-y_{I})(y-y_{T})*\\
\ \ \ \ \tan(\frac{\theta_{T}-\theta_{I}}{2})=(x-x_{I})(y-y_{T})-(x-x_{T})(y-y_{I})\}
\tag{3}\end{align*}

算法1给出了基于分段螺旋曲线的路径生成方法的详细描述。 如图3所示，我们展示了Li等人[14]提出的方法和模型预测局部路径生成方法的比较。 由于系统模型的强非线性，基于模型预测的路径生成方法无法通过分析方法求解，因此需要通过数值积分方法求解。 在实际应用中，该方法可能无法得到可行的解决方案或缓慢收敛。 在本文中，我们使用分段螺旋曲线作为路径基元，避免了迭代求解，因此具有计算成本低的优点。 另外，我们可以发现，通过给定的初始状态和目标状态，我们的方法可以得到一组连续曲率并满足初始状态和目标状态的约束，以确保候选路径的灵活性。

##### C.路径评估
首先明确检查生成的候选路径以确保安全。 选择具有最小成本的候选路径作为最佳路径。 我们设计了一个成本函数来评估规划结果的安全性，平滑性和一致性：

#### 结论
本文研究了结构化环境下自动驾驶汽车的规划。 我们提出了一种基于状态空间采样的方法，用于生成与参考路径共形的候选路径。 该方法可以考虑各种非完整约束，如曲率上限，曲率变化率等。由于我们的方法避免求解非线性方程，因此提高了算法的实时性。 仿真结果表明，它可以平滑地跟踪参考路径，避免静态障碍物。 未来的工作主要集中在动态避障和参考路径的优化，考虑静态障碍和道路边界的约束。

